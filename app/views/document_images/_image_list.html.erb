<% images = @document.images.sort_by do |image|
  image.id == @document.lead_image_id ? 0 : 1
end %>

<% images.each_with_index do |image, i| %>
  <% remove_lead_image_button = capture do %>
    <%= form_tag remove_document_lead_image_path(@document), method: :delete, class: "app-inline-block" do %>
      <button class="govuk-link">Remove</button>
    <% end %>
  <% end %>

  <% choose_image_button = capture do %>
    <%= form_tag choose_document_lead_image_path(@document, image), class: "app-inline-block" do %>
      <button class="govuk-link">Choose image</button>
    <% end %>
  <% end %>

  <% secondary_actions = [
    link_to("Edit crop", crop_document_image_path(@document, image), class: "govuk-link"),
    link_to("Edit details", edit_document_image_path(@document, image), class: "govuk-link"),
  ] %>

  <% unless @document.has_live_version_on_govuk %>
    <% secondary_actions << capture do %>
      <% if image.id == @document.lead_image_id %>
        <%= form_tag destroy_document_image_path(@document, image), method: :delete, class: "app-inline-block" do %>
          <%= hidden_field_tag :wizard, "lead_image" %>
          <button class="govuk-link app-link--destructive">Delete lead image</button>
        <% end %>
      <% else %>
        <%= form_tag destroy_document_image_path(@document, image), method: :delete, class: "app-inline-block" do %>
          <button class="govuk-link app-link--destructive">Delete image</button>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <%= render "components/image_meta", {
    id: "image-#{image.id}",
    src: url_for(image.thumbnail),
    no_border: i == images.length - 1,
    meta: {
      alt_text: image.alt_text,
      caption: image.caption,
      credit: image.credit
    },
    primary_action: image.id == @document.lead_image_id ?
      { tag: t("document_images.index.lead_image"), action: remove_lead_image_button } :
      { action: choose_image_button },
    secondary_actions: secondary_actions
  } %>
<% end %>
