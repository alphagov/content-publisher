<% images = @document.images.reject { |image| image.id == @document.lead_image_id } %>

<% if images.any? %>
  <h2 class="govuk-heading-m">
    <%= t("images.index.other_images") %>
  </h2>

  <% images.each_with_index do |image, i| %>
    <% actions = [] %>

    <% unless image.publication_state == "live" %>
      <% actions << link_to("Edit crop", crop_image_path(@document, image), class: "govuk-link") %>
      <% actions << link_to("Edit details", edit_image_path(@document, image), class: "govuk-link") %>
      <% actions << link_to('Download 960x640 image', download_image_path(@document, image), class: "govuk-link") %>
    <% end %>

    <% actions << capture do %>
      <%= form_tag choose_lead_image_path(@document, image), class: "app-inline-block" do %>
        <button class="govuk-link">Select as lead image</button>
      <% end %>
    <% end %>

    <% unless image.publication_state == "live" %>
      <% actions << capture do %>
        <%= form_tag destroy_image_path(@document, image), method: :delete, class: "app-inline-block" do %>
          <button class="govuk-link app-link--destructive">Delete image</button>
        <% end %>
      <% end %>
    <% end %>

    <% metadata_items = [
      {
        field: t("images.index.meta.alt_text"),
        value: image.alt_text,
      },
      {
        field: t("images.index.meta.caption"),
        value: image.caption,
      },
      {
        field: t("images.index.meta.credit"),
        value: image.credit,
      },
    ] %>

    <% if current_user.has_permission?(User::PRE_RELEASE_FEATURES_PERMISSION) %>
      <% metadata_items <<
        {
          field: t("images.index.meta.snippet.label"),
          value: t("images.index.meta.snippet.value", file: image.filename),
        }
      %>
    <% end %>

    <%= render "components/image_meta", {
      id: "image-#{image.id}",
      src: url_for(image.thumbnail),
      alt_text: image.alt_text,
      actions: actions,
      metadata_items: metadata_items,
    } %>
  <% end %>
<% end %>
